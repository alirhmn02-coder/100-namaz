<!DOCTYPE html>
<html lang="tr">
<style>
  /* Menimpa semua elemen yang memiliki warna latar oranye secara paksa */
  * {
    --ungu-keren: #6f42c1; /* Kamu bisa ganti kode hex ini */
  }

  /* Mengganti latar belakang oranye menjadi ungu */
  [style*="background: orange"], 
  [style*="background-color: orange"],
  [style*="background: #ffa500"],
  [style*="background-color: #ffa500"] {
    background-color: var(--ungu-keren) !important;
  }

  /* Mengganti warna teks oranye menjadi ungu */
  [style*="color: orange"],
  [style*="color: #ffa500"] {
    color: var(--ungu-keren) !important;
  }
</style>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ber√¢t Kandili - 100 Rekat Namaz Takibi</title>
    <meta name="description"
        content="100 rek√¢tlik bu namazƒ± kƒ±lan kimse, o sene √∂l√ºrse ≈üehitlik mertebesine n√¢il olur. Bu namazƒ±n sƒ±hhatlƒ± takibi i√ßin bu sayfayƒ± kullanabilir, sonunda evinize g√∂nderilecek hediye i√ßin talep olu≈üturabilirsiniz!">
    <link rel="icon" type="image/svg+xml" href="beraat-kandili-favicon.svg">
    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;600&display=swap"
        rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- intl-tel-input for phone country codes -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@25.2.0/build/css/intlTelInput.css">
    <!-- Confetti Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <!-- Google Places API - Dinamik olarak y√ºklenecek -->

    <style>
        :root {
            --primary: #fbbf24;
            /* Altƒ±n */
            --primary-dim: rgba(251, 191, 36, 0.2);
            --bg-dark: #0f172a;
            /* Gece Mavisi */
            --bg-card: #1e293b;
            --text-light: #f8fafc;
            --text-muted: #94a3b8;
            --success: #10b981;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-light);
            min-height: 100vh;
            padding-bottom: 90px;
            /* Footer payƒ± */
            overflow-x: hidden;
        }

        /* Header */
        header {
            padding: 25px 20px 10px;
            text-align: center;
            background: linear-gradient(180deg, rgba(15, 23, 42, 1) 0%, rgba(15, 23, 42, 0) 100%);
            position: sticky;
            top: 0;
            z-index: 10;
            backdrop-filter: blur(8px);
        }

        h1 {
            font-family: 'Amiri', serif;
            color: var(--primary);
            font-size: 2rem;
            margin-bottom: 5px;
            text-shadow: 0 0 15px rgba(251, 191, 36, 0.3);
        }

        .subtitle {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        /* Bilgi Kartƒ± (Accordion) */
        .info-card {
            margin: 15px 15px 25px;
            background: var(--bg-card);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            overflow: hidden;
        }

        .info-header {
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
        }

        .info-content {
            padding: 0 15px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, padding 0.3s ease;
            will-change: max-height;
            font-size: 0.9rem;
            line-height: 1.6;
            color: #cbd5e1;
            border-top: 1px solid transparent;
        }

        .info-content.open {
            padding: 15px;
            max-height: 600px;
            border-top-color: rgba(255, 255, 255, 0.05);
        }

        .niyet-box {
            background: var(--primary-dim);
            color: var(--primary);
            padding: 10px;
            border-radius: 8px;
            font-family: 'Amiri', serif;
            font-size: 1.1rem;
            margin-bottom: 10px;
            font-style: italic;
        }

        /* Grid Sistemi */
        .container {
            padding: 0 15px;
            max-width: 600px;
            margin: 0 auto;
        }

        .grid-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .grid-boxes {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
        }

        .box {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.05);
            border: 2px dashed rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            position: relative;
            position: relative;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: transform;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.3);
            font-weight: 600;
        }

        .box::before {
            content: '\f067';
            /* FontAwesome Plus */
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            font-size: 0.9rem;
            opacity: 0.4;
            transition: all 0.2s;
        }

        .box:hover::before {
            opacity: 0.8;
            color: var(--primary);
        }

        .box.next-up {
            border-color: var(--primary);
            animation: pulse 2s infinite;
        }

        .box.next-up::before {
            color: var(--primary);
            opacity: 0.8;
        }

        @keyframes pulse {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.4);
            }

            50% {
                box-shadow: 0 0 0 8px rgba(251, 191, 36, 0);
            }
        }

        .box:active {
            transform: scale(0.9);
        }

        .box.completed {
            background: var(--primary);
            border: 2px solid var(--primary);
            color: #000;
            box-shadow: 0 0 10px var(--primary-dim);
            animation: none;
        }

        .box.completed::before {
            display: none;
        }

        .box.completed::after {
            content: '\f00c';
            /* FontAwesome Check */
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            font-size: 1.2rem;
        }

        /* Tamamlama Animasyonu */
        .box.just-completed {
            animation: celebrate 0.6s ease-out;
        }

        @keyframes celebrate {
            0% {
                transform: scale(1);
            }

            25% {
                transform: scale(1.3);
            }

            50% {
                transform: scale(0.9);
            }

            75% {
                transform: scale(1.1);
            }

            100% {
                transform: scale(1);
            }
        }

        /* I≈üƒ±k Halkasƒ± Efekti */
        .ripple-effect {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(251, 191, 36, 0.6) 0%, transparent 70%);
            animation: ripple 0.8s ease-out forwards;
            pointer-events: none;
            z-index: 50;
        }

        @keyframes ripple {
            0% {
                width: 20px;
                height: 20px;
                opacity: 1;
            }

            100% {
                width: 150px;
                height: 150px;
                opacity: 0;
            }
        }

        /* Yƒ±ldƒ±z Par√ßacƒ±klarƒ± */
        .star-particle {
            position: absolute;
            color: var(--primary);
            font-size: 12px;
            animation: starBurst 0.8s ease-out forwards;
            pointer-events: none;
            z-index: 51;
        }

        @keyframes starBurst {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(1);
            }

            100% {
                opacity: 0;
                transform: translate(var(--tx), var(--ty)) scale(0.5);
            }
        }

        /* Milestone Kutlamasƒ± */
        .milestone-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            width: 100%;
            height: 100vh;
            height: 100dvh;
            background: radial-gradient(circle at center, rgba(15, 23, 42, 0.9) 0%, rgba(15, 23, 42, 0.4) 60%, transparent 100%);
            z-index: 190;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
            animation: fadeIn 0.3s ease-out;
        }

        .milestone-toast {
            /* position: fixed; kaldƒ±rƒ±ldƒ± overlay i√ßinde flex center olacak */
            background: linear-gradient(135deg, var(--primary), #f59e0b);
            color: #0f172a;
            padding: 25px 30px;
            border-radius: 20px;
            font-weight: 800;
            font-size: 1.4rem;
            z-index: 200;
            max-width: 85%;
            text-align: center;
            /* G√º√ßl√º kontrast g√∂lgesi ve ince border */
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), 0 0 0 4px rgba(15, 23, 42, 0.8);
            text-shadow: 0 1px 0 rgba(255, 255, 255, 0.2);
            transform: scale(0);
            animation: toastPop 2.5s ease-in-out forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes toastPop {
            0% {
                transform: scale(0);
                opacity: 0;
            }

            15% {
                transform: scale(1.1);
                opacity: 1;
            }

            25% {
                transform: scale(1);
            }

            80% {
                transform: scale(1);
                opacity: 1;
            }

            100% {
                transform: scale(0.8);
                opacity: 0;
            }
        }

        /* Sticky Footer */
        .footer-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 15px 20px 25px;
            /* iOS home bar i√ßin extra padding */
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 100;
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.3);
            /* Samsung Browser Fix: Hardware Acceleration */
            transform: translateZ(0);
            -webkit-transform: translateZ(0);
            will-change: transform;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .progress-bg {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px var(--primary);
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            padding: 20px;
        }

        .modal.active {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content {
            background: var(--bg-card);
            width: 100%;
            max-width: 400px;
            max-height: 85vh;
            overflow-y: auto;
            border-radius: 16px;
            padding: 25px;
            padding-top: 45px;
            border: 1px solid var(--primary);
            text-align: center;
            transform: translateY(20px);
            transition: transform 0.3s ease;
            position: relative;
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .task-list {
            margin: 20px 0;
            text-align: left;
        }

        .task-item {
            display: block;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
            overflow: hidden;
        }

        .task-item.active {
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.15);
        }

        .task-item.checked {
            background: rgba(16, 185, 129, 0.1);
            border-color: rgba(16, 185, 129, 0.3);
        }

        .task-item.checked.active {
            border-color: var(--success);
        }

        .task-header {
            display: flex;
            align-items: center;
            padding: 14px;
            cursor: pointer;
        }

        .custom-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--text-muted);
            border-radius: 6px;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.2s;
        }

        .task-item.checked .custom-checkbox {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .task-text {
            font-size: 0.9rem;
            flex-grow: 1;
        }

        .task-count {
            font-weight: bold;
            color: var(--primary);
            font-size: 0.85rem;
            background: rgba(251, 191, 36, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
        }

        .task-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, padding 0.3s ease;
            padding: 0 14px;
        }

        .task-item.active .task-details {
            max-height: 800px;
            padding: 0 14px 14px 14px;
        }

        .task-arabic {
            font-family: 'Amiri', serif;
            font-size: 1.2rem;
            color: var(--primary);
            text-align: right;
            direction: rtl;
            line-height: 2;
            margin-bottom: 12px;
            padding: 15px;
            background: rgba(251, 191, 36, 0.08);
            border-radius: 10px;
            border: 1px solid rgba(251, 191, 36, 0.2);
        }

        .task-turkish {
            font-size: 0.9rem;
            color: var(--text-muted);
            line-height: 1.7;
            padding: 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            border-left: 3px solid var(--primary);
        }

        .task-check-btn {
            display: block;
            width: 100%;
            padding: 12px;
            margin-top: 12px;
            background: var(--success);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .task-check-btn:hover {
            opacity: 0.9;
        }

        .task-check-btn:active {
            transform: scale(0.98);
        }

        /* Form Elements */
        .form-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 5px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: white;
            font-size: 16px;
            /* Zoom engellemek i√ßin */
            font-family: inherit;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-input.valid {
            border-color: var(--success);
        }

        .form-input.invalid {
            border-color: #ef4444;
        }

        .form-input {
            margin-bottom: 10px;
        }

        .email-input-wrapper,
        .address-input-wrapper {
            margin-bottom: 0;
        }

        .validation-message {
            font-size: 0.8rem;
            margin: 0;
        }

        .validation-message:not(:empty) {
            margin-top: 5px;
            margin-bottom: 10px;
        }

        .validation-message.error {
            color: #ef4444;
        }

        .validation-message.success {
            color: var(--success);
        }

        /* Google Places Autocomplete Styles */
        .pac-container {
            background-color: var(--bg-card);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            margin-top: 5px;
            font-family: 'Inter', sans-serif;
        }

        .pac-item {
            padding: 10px;
            color: var(--text-light);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            cursor: pointer;
        }

        .pac-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .pac-item-query {
            color: var(--primary);
        }

        .pac-matched {
            font-weight: bold;
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: var(--primary);
            color: #0f172a;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1rem;
            margin-top: 10px;
            cursor: pointer;
            transition: transform 0.1s;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn:disabled {
            background: var(--text-muted);
            opacity: 0.5;
            cursor: not-allowed;
        }

        .hidden {
            display: none;
        }

        /* intl-tel-input Dark Theme Customization */
        .iti {
            width: 100%;
            margin-bottom: 10px;
        }

        .iti__tel-input {
            width: 100%;
            padding: 12px;
            padding-left: 52px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: white;
            font-size: 16px;
            font-family: inherit;
        }

        .iti__tel-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .iti__country-container {
            padding: 0;
        }

        .iti__selected-country {
            background: transparent;
            border-radius: 8px 0 0 8px;
            padding: 0 8px;
        }

        .iti__selected-country:hover,
        .iti__selected-country:focus {
            background: rgba(255, 255, 255, 0.1);
        }

        .iti__arrow {
            border-top-color: var(--text-muted);
        }

        .iti__arrow--up {
            border-bottom-color: var(--text-muted);
        }

        .iti__dropdown {
            background: var(--bg-card) !important;
            background-color: var(--bg-card) !important;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .iti__country-list {
            background: var(--bg-card) !important;
            background-color: var(--bg-card) !important;
        }

        .iti__search-input {
            background: rgba(0, 0, 0, 0.5) !important;
            background-color: rgba(0, 0, 0, 0.5) !important;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            color: white !important;
            padding: 8px 10px;
        }

        .iti__search-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .iti__search-input::placeholder {
            color: var(--text-muted);
        }

        .iti__country {
            padding: 8px 10px;
            color: var(--text-light) !important;
            background: transparent;
        }

        .iti__country:hover,
        .iti__country--highlight {
            background: rgba(251, 191, 36, 0.15) !important;
        }

        .iti__dial-code {
            color: var(--text-muted) !important;
        }

        .iti__divider {
            border-bottom-color: rgba(255, 255, 255, 0.1);
        }

        .iti__country-name {
            color: var(--text-light) !important;
        }

        /* Nurani Glow Efekti */
        /* Nurani Glow Efekti (Statik - Performans Dostu) */
        .nurani-glow {
            text-shadow: 0 0 20px rgba(251, 191, 36, 0.5), 0 0 40px rgba(251, 191, 36, 0.2);
            color: var(--primary);
        }
    </style>
</head>

<body>

    <header>
        <div
            style="display: flex; justify-content: space-between; align-items: center; max-width: 600px; margin: 0 auto;">
            <div style="width: 40px;"></div>
            <div style="text-align: center; flex: 1;">
                <h1 class="nurani-glow">Ber√¢t Gecesi</h1>
                <div class="subtitle">100 Rekat Hayƒ±r Namazƒ± Takibi</div>
            </div>
            <button onclick="resetProgress()"
                style="background: none; border: none; color: var(--text-muted); cursor: pointer; padding: 10px; font-size: 1.1rem;"
                title="ƒ∞lerlemeyi Sƒ±fƒ±rla">
                <i class="fas fa-rotate-right"></i>
            </button>
        </div>
    </header>

    <div class="info-card" style="margin-bottom: 5px;">
        <div class="info-header" onclick="toggleInfo()">
            <span><i class="fas fa-book-open" style="color:var(--primary); margin-right:8px;"></i> Niyet ve Tarif</span>
            <i class="fas fa-chevron-down" id="infoIcon"></i>
        </div>
        <div class="info-content" id="infoContent">
            <div class="niyet-box">
                ‚ÄúY√¢ Rabbi! Niyet ettim senin rƒ±z√¢-yƒ± ≈üer√Æfin i√ßin namaza. Beni afv-ƒ± ƒ∞l√¢h√Æ‚Äône, feyz-i ƒ∞l√¢h√Æ‚Äône mazhar
                eyle. Kasvet-i kalpten, d√ºnya ve √¢hiret sƒ±kƒ±ntƒ±larƒ±ndan hal√¢s eyleyip sa√Ædler defterine kaydeyle.‚Äù
            </div>
            <p><strong>Kƒ±lƒ±nƒ±≈üƒ±:</strong> Her rek√¢tte, F√¢tiha-i ≈üer√Æfeden sonra 10 ƒ∞hl√¢s-ƒ± ≈üer√Æf okunur, iki rek√¢tte bir
                sel√¢m verilerek 100 rek√¢te tamamlanƒ±r.</p>
        </div>
    </div>

    <div class="info-card" style="margin-top: 0;">
        <div class="info-header" onclick="toggleFazilet()">
            <span><i class="fas fa-star" style="color:var(--primary); margin-right:8px;"></i> Ber√¢t Gecesinin
                Faziletleri</span>
            <i class="fas fa-chevron-down" id="faziletIcon"></i>
        </div>
        <div class="info-content" id="faziletContent">
            <p>Sevgili Peygamber Efendimiz sallall√¢h√º aleyhi ve sellem ≈ü√∂yle buyurdular:</p>
            <ul style="padding-left: 20px; margin: 10px 0;">
                <li>≈û√¢b√¢n(-ƒ± ≈üer√Æf) ayƒ±nƒ±n on be≈üinci (yani Ber√¢t) gecesi olduƒüu zaman, gecesini ibadetle ge√ßirin,
                    g√ºnd√ºz√ºnde de oru√ß tutun.</li>
                <li>Her kim bu (Ber√¢t) gece(sinde) y√ºz rek√¢t namaz kƒ±larsa, All√¢h√º Te√¢l√¢, ona, y√ºz melek g√∂nderir.
                    Bunlardan otuzu, ona Cennet‚Äôi m√ºjdeler, otuzu Cehennem az√¢bƒ±ndan emniyette olduƒüunu s√∂yler, otuzu da
                    d√ºnya √¢fetlerini ondan geri √ßevirir. On melek de o kimseyi, ≈üeytanƒ±n tuzaklarƒ±ndan muhafaza eder.
                </li>
                <li>Kim ≈üu be≈ü geceyi ihy√¢ ederse o kimseye Cennet vacip olur: Terviye gecesi (Arefe‚Äôden √∂nceki gece),
                    Arefe gecesi, Kurban Bayramƒ± gecesi, Ramazan Bayramƒ± gecesi, ≈û√¢ban(-ƒ± ≈üer√Æf) ayƒ±nƒ±n on be≈üinci
                    gecesi.</li>
            </ul>
            <p><strong>Ber√¢t Gecesi‚Äônin hus√ªsiyetlerinden bazƒ±larƒ±:</strong></p>
            <ul style="padding-left: 20px; margin: 10px 0;">
                <li>Hikmetli her i≈ü -kullarƒ±n rƒ±zƒ±klarƒ±, ecelleri, ves√¢ir i≈üleri- bu gecede ayƒ±rt edilir; yazƒ±lƒ±r.</li>
                <li>Bu gecede ibadet etmek √ßok faziletlidir.</li>
                <li>Bu gecede rahmet iner. Had√Æs-i ≈üerifte, ‚Äú≈û√¢ban ayƒ±nƒ±n yarƒ±sƒ± olduƒüu gecede, All√¢h√º Te√¢l√¢
                    (rahmetiyle) d√ºnya sem√¢sƒ±na tecell√Æ eder‚Ä¶‚Äù buyurulmu≈ütur.</li>
                <li>M√ºminler maƒüfiret olunur, g√ºnahlarƒ± baƒüƒ±≈ülanƒ±r.</li>
                <li>Res√ªlullah (s.a.v.) Efendimize tam ≈üefaat sal√¢hiyeti bu gecede verilmi≈ütir. Sevgili Peygamberimiz
                    (s.a.v.), ≈û√¢b√¢n-ƒ± ≈üer√Æf ayƒ±nƒ±n on √º√ß√ºnc√º gecesinde All√¢h√º Te√¢l√¢‚Äôdan, √ºmmeti i√ßin ≈üefaat izni istedi.
                    All√¢h√º Te√¢l√¢, √ºmmetinin √º√ßte birine ≈üefaat izni verdi. On d√∂rd√ºnc√º gecesi, kalan √ºmmeti i√ßin ≈üefaat
                    izni istedi. All√¢h√º Te√¢l√¢, √ºmmetinin √º√ßte ikisine ≈üefaat izni verdi. On be≈üinci gecesi, kalan √ºmmeti
                    i√ßin ≈üefaat izni istedi. All√¢h√º Te√¢l√¢ -devenin, sahibinden ka√ßtƒ±ƒüƒ± gibi, All√¢h√º Te√¢l√¢‚Äôdan ka√ßanlar
                    h√¢ri√ß- √ºmmetinin tamamƒ±na ≈üefaat etmesine izin verdi.</li>
                <li>Bu gecede Zemzem Suyu‚Äônun √¢≈üik√¢r bir ≈üekilde artmasƒ±, All√¢h√º Te√¢l√¢‚Äônƒ±n bir s√ºnneti (√¢det-i
                    ƒ∞l√¢hiyye‚Äôsi)dir. Bunda ƒ∞l√¢h√Æ ilimlerin, hakikat ehlinin kalbinde artacaƒüƒ±na i≈üaret vardƒ±r."</li>
            </ul>
        </div>
    </div>

    <div class="container">
        <div class="grid-header">
            <span>ƒ∞lerleme Durumu</span>
            <span id="completedCount">0 / 50 Selam</span>
        </div>
        <div
            style="text-align: center; margin-bottom: 15px; padding: 10px; background: rgba(251, 191, 36, 0.1); border-radius: 8px; font-size: 0.85rem; color: var(--text-muted);">
            <i class="fas fa-hand-pointer" style="color: var(--primary); margin-right: 5px;"></i>
            Her 2 rekat kƒ±ldƒ±ktan sonra bir kutucuƒüa dokunun
        </div>
        <div class="grid-boxes" id="gridContainer">
            <!-- Kutular JS ile gelecek -->
        </div>
    </div>

    <div class="footer-bar">
        <div class="progress-info">
            <span style="color:var(--primary)">Toplam Rekat</span>
            <span id="rakatCount">0 / 100</span>
        </div>
        <div class="progress-bg">
            <div class="progress-fill" id="progressBar"></div>
        </div>
    </div>

    <!-- MODAL -->
    <div class="modal" id="mainModal">
        <div class="modal-content">
            <!-- Kapatma Butonu -->
            <button onclick="closeModal()"
                style="position:absolute; top:5px; right:5px; background:none; border:none; color:var(--text-muted); cursor:pointer; font-size:0.85rem; padding:3px 6px; opacity:0.5; transition:opacity 0.2s;"
                onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.5'">
                <i class="fas fa-times"></i>
            </button>

            <!-- A≈ûAMA 1: TESBƒ∞HAT -->
            <div id="stepTesbihat">
                <div style="font-size:3rem; margin-bottom:15px;">ü§≤üèª</div>
                <h2 style="font-family:'Amiri', serif; margin-bottom:10px;">Allah Kabul Etsin</h2>
                <p style="font-size:0.9rem; color:var(--text-muted);">M√¢≈ü√¢allah, namazƒ± tamamladƒ±nƒ±z! ≈ûimdi
                    tesbihatlarla devam edebiliriz.</p>

                <div class="task-list" id="taskList">
                    <!-- JS ile dolacak -->
                </div>

                <button class="btn" id="btnNext" disabled onclick="showForm()">
                    Hediyeni Al <i class="fas fa-arrow-right" style="margin-left:5px;"></i>
                </button>
            </div>

            <!-- A≈ûAMA 2: FORM -->
            <div id="stepForm" class="hidden">
                <h2 style="color:var(--primary); font-family:'Amiri', serif;">Hediye Zamanƒ±!</h2>
                <p style="font-size:0.9rem; color:var(--text-muted); margin-bottom:20px;">
                    Ramazan-ƒ± ≈ûerif √∂ncesinde hediyenizi evinize g√∂ndermek istiyoruz.
                </p>

                <form id="giftForm" onsubmit="submitForm(event)" autocomplete="on">
                    <!-- ƒ∞sim alanƒ± -->
                    <div class="name-input-wrapper">
                        <input type="text" name="name" id="inputName" class="form-input" placeholder="Ad Soyad" required
                            autocomplete="name">
                        <div class="validation-message" id="nameError"></div>
                    </div>

                    <!-- Email alanƒ± -->
                    <div class="email-input-wrapper">
                        <input type="email" name="email" id="inputEmail" class="form-input" placeholder="E-posta"
                            required autocomplete="email">
                        <div class="validation-message" id="emailError"></div>
                    </div>

                    <!-- Telefon alanƒ± (intl-tel-input) -->
                    <div class="phone-input-wrapper">
                        <input type="tel" name="phone" id="inputPhone" placeholder="Telefon Numarasƒ±" required
                            autocomplete="tel" inputmode="tel">
                        <input type="hidden" name="phoneIntl" id="phoneIntl">
                    </div>
                    <!-- Adres alanƒ± (Google Places Autocomplete) -->
                    <div class="address-input-wrapper">
                        <input type="text" name="address" id="inputAddress" class="form-input"
                            placeholder="Adresinizi yazƒ±n..." required autocomplete="street-address">
                        <div class="validation-message" id="addressError"></div>
                        <input type="hidden" name="addressFull" id="addressFull">
                        <input type="hidden" name="addressCity" id="addressCity">
                        <input type="hidden" name="addressCountry" id="addressCountry">
                    </div>

                    <button type="submit" class="btn" id="submitBtn" disabled>
                        Kaydƒ± Tamamla <i class="fas fa-check"></i>
                    </button>
                    <div class="validation-message" id="formError" style="text-align:center; margin-top:10px;"></div>
                    <p
                        style="font-size:0.7rem; color:var(--text-muted); text-align:center; margin-top:15px; opacity:0.6;">
                        Hediyelerimiz sƒ±nƒ±rlƒ± sayƒ±dadƒ±r.</p>
                </form>
            </div>

            <!-- A≈ûAMA 3: SONU√á -->
            <div id="stepSuccess" class="hidden">
                <div style="font-size:4rem; color:var(--success); margin-bottom:15px;">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h3>Kaydƒ±nƒ±z Alƒ±ndƒ±!</h3>
                <p style="margin:10px 0; color:var(--text-muted);">Bilgileriniz bize ula≈ütƒ±. M√ºbarek Ber√¢t Kandilinizi
                    tebrik ederiz.</p>
                <button class="btn" onclick="closeModal()"
                    style="background:transparent; border:1px solid var(--primary); color:var(--primary); margin-top:20px;">
                    Kapat
                </button>
            </div>

        </div>
    </div>

    <script>
        // --- KONFIGURASYON ---
        const totalBoxes = 50;

        // --- REFERRAL TRAKƒ∞NG ---
        const REFERRAL_STORAGE_KEY = 'berat_referral';

        function getReferralCode() {
            // URL'den ?r= parametresini oku
            const urlParams = new URLSearchParams(window.location.search);
            const urlReferral = urlParams.get('r');

            // URL'de varsa localStorage'a kaydet
            if (urlReferral) {
                localStorage.setItem(REFERRAL_STORAGE_KEY, urlReferral);
                return urlReferral;
            }

            // URL'de yoksa localStorage'dan al
            return localStorage.getItem(REFERRAL_STORAGE_KEY) || 'direct';
        }

        function getDeviceType() {
            return /Mobile|Android|iPhone|iPad/.test(navigator.userAgent) ? 'mobile' : 'desktop';
        }
        const tesbihatData = [
            {
                text: "ƒ∞stiƒüf√¢r-ƒ± ≈üer√Æf",
                count: 14,
                arabic: "ÿ£Ÿéÿ≥Ÿíÿ™Ÿéÿ∫ŸíŸÅŸêÿ±Ÿè ÿßŸÑŸÑŸáŸé ÿßŸÑŸíÿπŸéÿ∏ŸêŸäŸÖŸé ŸàŸéÿ£Ÿéÿ™ŸèŸàÿ®Ÿè ÿ•ŸêŸÑŸéŸäŸíŸáŸê",
                turkish: "Estaƒüfirull√¢hel az√Æm ve et√ªb√º ileyh"
            },
            {
                text: "Salev√¢t-ƒ± ≈üer√Æfe",
                count: 14,
                arabic: "ÿßŸéŸÑŸÑŸëŸ∞ŸáŸèŸÖŸéŸë ÿµŸéŸÑŸêŸë ÿπŸéŸÑŸ∞Ÿâ ÿ≥ŸéŸäŸêŸëÿØŸêŸÜŸéÿß ŸÖŸèÿ≠ŸéŸÖŸéŸëÿØŸç ŸàŸéÿπŸéŸÑŸ∞Ÿâ ÿßŸ∞ŸÑŸê ÿ≥ŸéŸäŸêŸëÿØŸêŸÜŸéÿß ŸÖŸèÿ≠ŸéŸÖŸéŸëÿØŸç",
                turkish: "All√¢h√ºmme salli al√¢ seyyidin√¢ Muhammedin ve al√¢ √¢li seyyidin√¢ Muhammed"
            },
            {
                text: "F√¢tiha-i ≈üer√Æfe",
                count: 14,
                arabic: "ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸëŸ∞ŸáŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸ∞ŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸñŸäŸÖŸê ‚ùÅ ÿßŸéŸÑŸíÿ≠ŸéŸÖŸíÿØŸè ŸÑŸêŸÑŸëŸ∞ŸáŸê ÿ±Ÿéÿ®ŸêŸë ÿßŸÑŸíÿπŸéÿßŸÑŸéŸÖŸñŸäŸÜŸé ‚ùÅ ÿßŸéŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸ∞ŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸñŸäŸÖŸê ‚ùÅ ŸÖŸéÿßŸÑŸêŸÉŸê ŸäŸéŸàŸíŸÖŸê ÿßŸÑÿØŸëŸñŸäŸÜŸê ‚ùÅ ÿßŸêŸäŸéŸëÿßŸÉŸé ŸÜŸéÿπŸíÿ®ŸèÿØŸè ŸàŸéÿßŸêŸäŸéŸëÿßŸÉŸé ŸÜŸéÿ≥Ÿíÿ™ŸéÿπŸñŸäŸÜŸè ‚ùÅ ÿßŸêŸáŸíÿØŸêŸÜŸéÿß ÿßŸÑÿµŸêŸëÿ±Ÿéÿßÿ∑Ÿé ÿßŸÑŸíŸÖŸèÿ≥Ÿíÿ™ŸéŸÇŸñŸäŸÖŸé ‚ùÅ ÿµŸêÿ±Ÿéÿßÿ∑Ÿé ÿßŸÑŸéŸëÿ∞ŸñŸäŸÜŸé ÿßŸéŸÜŸíÿπŸéŸÖŸíÿ™Ÿé ÿπŸéŸÑŸéŸäŸíŸáŸêŸÖŸí ÿ∫ŸéŸäŸíÿ±Ÿê ÿßŸÑŸíŸÖŸéÿ∫Ÿíÿ∂ŸèŸàÿ®Ÿê ÿπŸéŸÑŸéŸäŸíŸáŸêŸÖŸí ŸàŸéŸÑŸéÿß ÿßŸÑÿ∂ŸéŸëŸìÿßŸÑŸëŸñŸäŸÜŸé",
                turkish: "Bismill√¢hirrahm√¢nirrah√Æm. Elhamd√º lill√¢hi rabbil √¢lem√Æn. Errahm√¢nirrah√Æm. M√¢liki yevmidd√Æn. ƒ∞yy√¢ke na'b√ºd√º ve iyy√¢ke neste√Æn. ƒ∞hdinassƒ±r√¢tal m√ºstak√Æm. Sƒ±r√¢tallez√Æne en'amte aleyhim ƒüayril maƒüd√ªbi aleyhim veledd√¢ll√Æn."
            },
            {
                text: "√Çyet√º'l-K√ºrs√Æ",
                count: 14,
                arabic: "ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸëŸ∞ŸáŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸ∞ŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸñŸäŸÖŸê ‚ùÅ ÿßŸéŸÑŸÑŸëŸ∞ŸáŸè ŸÑŸéŸìÿß ÿßŸêŸÑŸ∞ŸáŸé ÿßŸêŸÑŸéŸëÿß ŸáŸèŸàŸé ÿßŸÑŸíÿ≠ŸéŸäŸèŸë ÿßŸÑŸíŸÇŸéŸäŸèŸëŸàŸÖŸè ŸÑŸéÿß ÿ™Ÿéÿ£ŸíÿÆŸèÿ∞ŸèŸáŸè ÿ≥ŸêŸÜŸéÿ©Ÿå ŸàŸéŸÑŸéÿß ŸÜŸéŸàŸíŸÖŸå ŸÑŸéŸáŸè ŸÖŸéÿß ŸÅŸêŸä ÿßŸÑÿ≥ŸéŸëŸÖŸ∞ŸàŸéÿßÿ™Ÿê ŸàŸéŸÖŸéÿß ŸÅŸêŸä ÿßŸÑŸíÿßŸéÿ±Ÿíÿ∂Ÿê ŸÖŸéŸÜŸí ÿ∞Ÿéÿß ÿßŸÑŸéŸëÿ∞ŸñŸä ŸäŸéÿ¥ŸíŸÅŸéÿπŸè ÿπŸêŸÜŸíÿØŸéŸáŸèŸì ÿßŸêŸÑŸéŸëÿß ÿ®ŸêÿßŸêÿ∞ŸíŸÜŸêŸáŸñ ŸäŸéÿπŸíŸÑŸéŸÖŸè ŸÖŸéÿß ÿ®ŸéŸäŸíŸÜŸé ÿßŸéŸäŸíÿØŸñŸäŸáŸêŸÖŸí ŸàŸéŸÖŸéÿß ÿÆŸéŸÑŸíŸÅŸéŸáŸèŸÖŸí ŸàŸéŸÑŸéÿß ŸäŸèÿ≠ŸñŸäÿ∑ŸèŸàŸÜŸé ÿ®Ÿêÿ¥ŸéŸäŸíÿ°Ÿç ŸÖŸêŸÜŸí ÿπŸêŸÑŸíŸÖŸêŸáŸñŸì ÿßŸêŸÑŸéŸëÿß ÿ®ŸêŸÖŸéÿß ÿ¥ŸéŸìÿßÿ°Ÿé ŸàŸéÿ≥ŸêÿπŸé ŸÉŸèÿ±Ÿíÿ≥ŸêŸäŸèŸëŸáŸè ÿßŸÑÿ≥ŸéŸëŸÖŸ∞ŸàŸéÿßÿ™Ÿê ŸàŸéÿßŸÑŸíÿßŸéÿ±Ÿíÿ∂Ÿé ŸàŸéŸÑŸéÿß ŸäŸéÿ§ŸèŸàÿØŸèŸáŸè ÿ≠ŸêŸÅŸíÿ∏ŸèŸáŸèŸÖŸéÿß ŸàŸéŸáŸèŸàŸé ÿßŸÑŸíÿπŸéŸÑŸêŸäŸèŸë ÿßŸÑŸíÿπŸéÿ∏ŸñŸäŸÖŸè",
                turkish: "Bismill√¢hirrahm√¢nirrah√Æm. All√¢h√º l√¢ il√¢he ill√¢ h√ºvel hayy√ºl kayy√ªm. L√¢ te'huz√ºh√ª sinet√ºn vel√¢ nevm. Leh√ª m√¢ fissem√¢v√¢ti ve m√¢ fil ard. Men zellez√Æ ye≈üfeu indeh√ª ill√¢ biiznih. Ya'lem√º m√¢ beyne eyd√Æhim ve m√¢ halfeh√ºm. Ve l√¢ y√ºh√Æt√ªne bi≈üey'in min ilmih√Æ ill√¢ bim√¢ ≈ü√¢e. Vesia k√ºrsiyy√ºh√ºs sem√¢v√¢ti vel ard. Ve l√¢ ye√ªd√ºh√ª hƒ±fzuh√ºm√¢ ve h√ºvel aliyy√ºl az√Æm."
            },
            {
                text: "Tevbe S√ªresi son 2 ayet",
                count: 14,
                arabic: "ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸëŸ∞ŸáŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸ∞ŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸñŸäŸÖŸê ‚ùÅ ŸÑŸéŸÇŸéÿØŸí ÿ¨ŸéŸìÿßÿ°ŸéŸÉŸèŸÖŸí ÿ±Ÿéÿ≥ŸèŸàŸÑŸå ŸÖŸêŸÜŸí ÿßŸéŸÜŸíŸÅŸèÿ≥ŸêŸÉŸèŸÖŸí ÿπŸéÿ≤ŸñŸäÿ≤Ÿå ÿπŸéŸÑŸéŸäŸíŸáŸê ŸÖŸéÿß ÿπŸéŸÜŸêÿ™ŸèŸëŸÖŸí ÿ≠Ÿéÿ±ŸñŸäÿµŸå ÿπŸéŸÑŸéŸäŸíŸÉŸèŸÖŸí ÿ®ŸêÿßŸÑŸíŸÖŸèÿ§ŸíŸÖŸêŸÜŸñŸäŸÜŸé ÿ±Ÿéÿ§ŸèŸàŸÅŸå ÿ±Ÿéÿ≠ŸñŸäŸÖŸå ‚ùÅ ŸÅŸéÿßŸêŸÜŸí ÿ™ŸéŸàŸéŸÑŸéŸëŸàŸíÿß ŸÅŸéŸÇŸèŸÑŸí ÿ≠Ÿéÿ≥Ÿíÿ®ŸêŸäŸé ÿßŸÑŸÑŸëŸ∞ŸáŸè ŸÑŸéŸìÿß ÿßŸêŸÑŸ∞ŸáŸé ÿßŸêŸÑŸéŸëÿß ŸáŸèŸàŸé ÿπŸéŸÑŸéŸäŸíŸáŸê ÿ™ŸéŸàŸéŸÉŸéŸëŸÑŸíÿ™Ÿè ŸàŸéŸáŸèŸàŸé ÿ±Ÿéÿ®ŸèŸë ÿßŸÑŸíÿπŸéÿ±Ÿíÿ¥Ÿê ÿßŸÑŸíÿπŸéÿ∏ŸñŸäŸÖŸê",
                turkish: "Bismill√¢hirrahm√¢nirrah√Æm. Lekad c√¢ek√ºm res√ªl√ºn min enf√ºsik√ºm az√Æz√ºn aleyhi m√¢ anitt√ºm har√Æsun aleyk√ºm bil m√º'min√Æne ra√ªf√ºn rah√Æm. Fein tevellev fekul hasbiyall√¢h√º l√¢ il√¢he ill√¢ h√ª, aleyhi tevekkelt√º ve h√ºve rabb√ºl ar≈üil az√Æm."
            },
            {
                text: "14 'Yasin' dedikten sonra Y√¢s√Æn S√ªresi",
                count: 1,
                arabic: null,
                turkish: null
            },
            {
                text: "ƒ∞hl√¢s-ƒ± ≈üer√Æf",
                count: 14,
                arabic: "ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸëŸ∞ŸáŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸ∞ŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸñŸäŸÖŸê ‚ùÅ ŸÇŸèŸÑŸí ŸáŸèŸàŸé ÿßŸÑŸÑŸëŸ∞ŸáŸè ÿßŸéÿ≠ŸéÿØŸå ‚ùÅ ÿßŸéŸÑŸÑŸëŸ∞ŸáŸè ÿßŸÑÿµŸéŸëŸÖŸéÿØŸè ‚ùÅ ŸÑŸéŸÖŸí ŸäŸéŸÑŸêÿØŸí ŸàŸéŸÑŸéŸÖŸí ŸäŸèŸàŸÑŸéÿØŸí ‚ùÅ ŸàŸéŸÑŸéŸÖŸí ŸäŸéŸÉŸèŸÜŸí ŸÑŸéŸáŸè ŸÉŸèŸÅŸèŸàŸãÿß ÿßŸéÿ≠ŸéÿØŸå",
                turkish: "Bismill√¢hirrahm√¢nirrah√Æm. Kul h√ºvall√¢h√º ehad. All√¢h√ºs samed. Lem yelid ve lem y√ªled. Ve lem yek√ºn leh√ª k√ºf√ºven ehad."
            },
            {
                text: "Felak S√ªresi",
                count: 14,
                arabic: "ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸëŸ∞ŸáŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸ∞ŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸñŸäŸÖŸê ‚ùÅ ŸÇŸèŸÑŸí ÿßŸéÿπŸèŸàÿ∞Ÿè ÿ®Ÿêÿ±Ÿéÿ®ŸêŸë ÿßŸÑŸíŸÅŸéŸÑŸéŸÇŸê ‚ùÅ ŸÖŸêŸÜŸí ÿ¥Ÿéÿ±ŸêŸë ŸÖŸéÿß ÿÆŸéŸÑŸéŸÇŸé ‚ùÅ ŸàŸéŸÖŸêŸÜŸí ÿ¥Ÿéÿ±ŸêŸë ÿ∫Ÿéÿßÿ≥ŸêŸÇŸç ÿßŸêÿ∞Ÿéÿß ŸàŸéŸÇŸéÿ®Ÿé ‚ùÅ ŸàŸéŸÖŸêŸÜŸí ÿ¥Ÿéÿ±ŸêŸë ÿßŸÑŸÜŸéŸëŸÅŸéŸëÿßÿ´Ÿéÿßÿ™Ÿê ŸÅŸêŸä ÿßŸÑŸíÿπŸèŸÇŸéÿØŸê ‚ùÅ ŸàŸéŸÖŸêŸÜŸí ÿ¥Ÿéÿ±ŸêŸë ÿ≠Ÿéÿßÿ≥ŸêÿØŸç ÿßŸêÿ∞Ÿéÿß ÿ≠Ÿéÿ≥ŸéÿØŸé",
                turkish: "Bismill√¢hirrahm√¢nirrah√Æm. Kul e√ªz√º birabbil felak. Min ≈üerri m√¢ halak. Ve min ≈üerri ƒü√¢sikƒ±n iz√¢ vekab. Ve min ≈üerrin neff√¢s√¢ti fil ukad. Ve min ≈üerri h√¢sidin iz√¢ hased."
            },
            {
                text: "N√¢s S√ªresi",
                count: 14,
                arabic: "ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸëŸ∞ŸáŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸ∞ŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸñŸäŸÖŸê ‚ùÅ ŸÇŸèŸÑŸí ÿßŸéÿπŸèŸàÿ∞Ÿè ÿ®Ÿêÿ±Ÿéÿ®ŸêŸë ÿßŸÑŸÜŸéŸëÿßÿ≥Ÿê ‚ùÅ ŸÖŸéŸÑŸêŸÉŸê ÿßŸÑŸÜŸéŸëÿßÿ≥Ÿê ‚ùÅ ÿßŸêŸÑŸ∞ŸáŸê ÿßŸÑŸÜŸéŸëÿßÿ≥Ÿê ‚ùÅ ŸÖŸêŸÜŸí ÿ¥Ÿéÿ±ŸêŸë ÿßŸÑŸíŸàŸéÿ≥ŸíŸàŸéÿßÿ≥Ÿê ÿßŸÑŸíÿÆŸéŸÜŸéŸëÿßÿ≥Ÿê ‚ùÅ ÿßŸéŸÑŸéŸëÿ∞ŸñŸä ŸäŸèŸàŸéÿ≥ŸíŸàŸêÿ≥Ÿè ŸÅŸñŸä ÿµŸèÿØŸèŸàÿ±Ÿê ÿßŸÑŸÜŸéŸëÿßÿ≥Ÿê ‚ùÅ ŸÖŸêŸÜŸé ÿßŸÑŸíÿ¨ŸêŸÜŸéŸëÿ©Ÿê ŸàŸéÿßŸÑŸÜŸéŸëÿßÿ≥Ÿê",
                turkish: "Bismill√¢hirrahm√¢nirrah√Æm. Kul e√ªz√º birabbin n√¢s. Melikin n√¢s. ƒ∞l√¢hin n√¢s. Min ≈üerril vesv√¢sil hann√¢s. Ellez√Æ y√ºvesvis√º f√Æ sud√ªrin n√¢s. Minel cinneti ven n√¢s."
            },
            {
                text: "S√ºbh√¢nell√¢hi ve'l-hamd√º...",
                count: 14,
                arabic: "ÿ≥Ÿèÿ®Ÿíÿ≠ŸéÿßŸÜŸé ÿßŸÑŸÑŸëŸ∞ŸáŸê ŸàŸéÿßŸÑŸíÿ≠ŸéŸÖŸíÿØŸè ŸÑŸêŸÑŸëŸ∞ŸáŸê ŸàŸéŸÑŸéŸìÿß ÿßŸêŸÑŸ∞ŸáŸé ÿßŸêŸÑŸéŸëÿß ÿßŸÑŸÑŸëŸ∞ŸáŸè ŸàŸéÿßŸÑŸÑŸëŸ∞ŸáŸè ÿßŸéŸÉŸíÿ®Ÿéÿ±Ÿè ŸàŸéŸÑŸéÿß ÿ≠ŸéŸàŸíŸÑŸé ŸàŸéŸÑŸéÿß ŸÇŸèŸàŸéŸëÿ©Ÿé ÿßŸêŸÑŸéŸëÿß ÿ®ŸêÿßŸÑŸÑŸëŸ∞ŸáŸê ÿßŸÑŸíÿπŸéŸÑŸêŸäŸêŸë ÿßŸÑŸíÿπŸéÿ∏ŸñŸäŸÖŸê",
                turkish: "S√ºbh√¢nall√¢hi vel hamd√º lill√¢hi ve l√¢ il√¢he illall√¢h√º vall√¢h√º ekber. Ve l√¢ havle ve l√¢ kuvvete ill√¢ bill√¢hil aliyyil az√Æm."
            },
            {
                text: "Sal√¢t-ƒ± M√ºnciye",
                count: 14,
                arabic: "ÿßŸéŸÑŸÑŸëŸ∞ŸáŸèŸÖŸéŸë ÿµŸéŸÑŸêŸë ÿπŸéŸÑŸ∞Ÿâ ÿ≥ŸéŸäŸêŸëÿØŸêŸÜŸéÿß ŸÖŸèÿ≠ŸéŸÖŸéŸëÿØŸç ŸàŸéÿπŸéŸÑŸ∞Ÿâ ÿßŸ∞ŸÑŸê ÿ≥ŸéŸäŸêŸëÿØŸêŸÜŸéÿß ŸÖŸèÿ≠ŸéŸÖŸéŸëÿØŸç ÿµŸéŸÑŸéÿßÿ©Ÿã ÿ™ŸèŸÜŸíÿ¨ŸñŸäŸÜŸéÿß ÿ®ŸêŸáŸéÿß ŸÖŸêŸÜŸí ÿ¨ŸéŸÖŸñŸäÿπŸê ÿßŸÑŸíÿßŸéŸáŸíŸàŸéÿßŸÑŸê ŸàŸéÿßŸÑŸíÿßŸ∞ŸÅŸéÿßÿ™Ÿê ŸàŸéÿ™ŸéŸÇŸíÿ∂ŸñŸä ŸÑŸéŸÜŸéÿß ÿ®ŸêŸáŸéÿß ÿ¨ŸéŸÖŸñŸäÿπŸé ÿßŸÑŸíÿ≠Ÿéÿßÿ¨Ÿéÿßÿ™Ÿê ŸàŸéÿ™Ÿèÿ∑ŸéŸáŸêŸëÿ±ŸèŸÜŸéÿß ÿ®ŸêŸáŸéÿß ŸÖŸêŸÜŸí ÿ¨ŸéŸÖŸñŸäÿπŸê ÿßŸÑÿ≥ŸéŸëŸäŸêŸëÿ¶Ÿéÿßÿ™Ÿê ŸàŸéÿ™Ÿéÿ±ŸíŸÅŸéÿπŸèŸÜŸéÿß ÿ®ŸêŸáŸéÿß ÿπŸêŸÜŸíÿØŸéŸÉŸé ÿßŸéÿπŸíŸÑŸéŸâ ÿßŸÑÿØŸéŸëÿ±Ÿéÿ¨Ÿéÿßÿ™Ÿê ŸàŸéÿ™Ÿèÿ®ŸéŸÑŸêŸëÿ∫ŸèŸÜŸéÿß ÿ®ŸêŸáŸéÿß ÿßŸéŸÇŸíÿµŸéŸâ ÿßŸÑŸíÿ∫ŸéÿßŸäŸéÿßÿ™Ÿê ŸÖŸêŸÜŸí ÿ¨ŸéŸÖŸñŸäÿπŸê ÿßŸÑŸíÿÆŸéŸäŸíÿ±Ÿéÿßÿ™Ÿê ŸÅŸêŸä ÿßŸÑŸíÿ≠ŸéŸäŸéÿßÿ©Ÿê ŸàŸéÿ®ŸéÿπŸíÿØŸé ÿßŸÑŸíŸÖŸéŸÖŸéÿßÿ™Ÿê",
                turkish: "All√¢h√ºmme salli al√¢ seyyidin√¢ Muhammedin ve al√¢ √¢li seyyidin√¢ Muhammed. Sal√¢ten t√ºnc√Æn√¢ bih√¢ min cem√Æil ehv√¢li vel √¢f√¢t. Ve takd√Æ len√¢ bih√¢ cem√Æal h√¢c√¢t. Ve t√ºtahhirun√¢ bih√¢ min cem√Æis seyyi√¢t. Ve terfeun√¢ bih√¢ indeke a'led derec√¢t. Ve t√ºbelliƒüun√¢ bih√¢ aks√¢l ƒü√¢y√¢t. Min cem√Æil hayr√¢ti fil hay√¢ti ve ba'del mem√¢t."
            }
        ];

        // --- STATE ---
        let completed = JSON.parse(localStorage.getItem('berat_progress')) || [];
        let completedTasks = JSON.parse(localStorage.getItem('berat_tasks')) || [];
        let currentStep = localStorage.getItem('berat_step') || 'grid'; // 'grid', 'tesbihat', 'form', 'success'
        let isEarlySubmission = localStorage.getItem('berat_is_early') === 'true';

        // --- DOM ELEMENTLERI ---
        const gridEl = document.getElementById('gridContainer');
        const progressFill = document.getElementById('progressBar');
        const rakatCountEl = document.getElementById('rakatCount');
        const completedCountEl = document.getElementById('completedCount');
        const modal = document.getElementById('mainModal');

        // --- INIT ---
        function init() {
            renderGrid();
            updateStats();
            renderTasks();
            restoreState();
            // Google Places API'yi y√ºklemeyi dene (API key varsa)
            loadGooglePlacesAPI();

            // Ziyaret takibi (session ba≈üƒ±na bir kez)
            const visitKey = 'berat_visited_' + new Date().toDateString();
            if (!sessionStorage.getItem(visitKey)) {
                trackVisit();
                sessionStorage.setItem(visitKey, '1');
            }
        }

        // --- DURUM GERƒ∞ Y√úKLEME ---
        function restoreState() {
            // Eƒüer t√ºm namazlar tamamlanmƒ±≈üsa VEYA erken ba≈üvuru yapƒ±lmƒ±≈üsa
            if (completed.length === totalBoxes || isEarlySubmission) {
                if (currentStep === 'tesbihat' && !isEarlySubmission) {
                    modal.classList.add('active');
                    // Tesbihat durumunu geri y√ºkle
                    restoreTaskState();
                } else if (currentStep === 'form') {
                    modal.classList.add('active');
                    document.getElementById('stepTesbihat').classList.add('hidden');
                    document.getElementById('stepForm').classList.remove('hidden');
                    // Form validasyonlarƒ±nƒ± ba≈ülat
                    setTimeout(() => initFormValidation(), 100);
                } else if (currentStep === 'success') {
                    modal.classList.add('active');
                    document.getElementById('stepTesbihat').classList.add('hidden');
                    document.getElementById('stepForm').classList.add('hidden');
                    document.getElementById('stepSuccess').classList.remove('hidden');
                }
            }
        }

        // --- TESBƒ∞HAT DURUMUNU GERƒ∞ Y√úKLE ---
        function restoreTaskState() {
            const allItems = document.querySelectorAll('.task-item');
            allItems.forEach((item, idx) => {
                if (completedTasks.includes(idx)) {
                    item.classList.add('checked');
                    const icon = item.querySelector('.fa-check');
                    if (icon) icon.style.display = 'block';
                }
            });
            // ƒ∞lk tamamlanmamƒ±≈üƒ± a√ß
            openFirstUncheckedTask();
            // Buton durumunu g√ºncelle
            const checkedItems = document.querySelectorAll('.task-item.checked');
            document.getElementById('btnNext').disabled = (allItems.length !== checkedItems.length);
        }

        // --- ƒ∞LERLEMEYƒ∞ SIFIRLA ---
        function resetProgress() {
            if (confirm('T√ºm ilerlemenizi sƒ±fƒ±rlamak istediƒüinize emin misiniz?')) {
                localStorage.removeItem('berat_progress');
                localStorage.removeItem('berat_tasks');
                localStorage.removeItem('berat_step');
                localStorage.removeItem('berat_is_early');
                location.reload();
            }
        }

        // --- MODALI KAPAT ---
        function closeModal() {
            modal.classList.remove('active');
        }

        // --- GRID RENDER ---
        function renderGrid() {
            gridEl.innerHTML = '';
            // Bir sonraki bo≈ü kutucuƒüu bulmak i√ßin
            let nextIndex = -1;
            for (let i = 0; i < totalBoxes; i++) {
                if (!completed.includes(i)) {
                    nextIndex = i;
                    break;
                }
            }

            for (let i = 0; i < totalBoxes; i++) {
                const box = document.createElement('div');
                box.id = `box-${i}`; // ID ekle
                const isCompleted = completed.includes(i);
                box.className = `box ${isCompleted ? 'completed' : ''}`;

                if (i === nextIndex) {
                    box.classList.add('next-up');
                }

                box.onclick = () => toggleBox(i);
                gridEl.appendChild(box);
            }
        }

        // --- ETKILE≈ûIM ---
        function toggleBox(index) {
            // Titre≈üim efekti (Mobile haptic)
            if (navigator.vibrate) navigator.vibrate(10);

            let wasCompleted = completed.includes(index);
            const box = document.getElementById(`box-${index}`);

            if (wasCompleted) {
                // Silme i≈ülemi
                completed = completed.filter(id => id !== index);
                if (box) box.classList.remove('completed');
            } else {
                // Ekleme i≈ülemi
                completed.push(index);
                if (box) box.classList.add('completed');

                // Animasyonlar
                triggerCompletionEffects(index);
            }

            // localStorage g√ºncelle
            localStorage.setItem('berat_progress', JSON.stringify(completed));

            // Next-up (yanƒ±p s√∂nen kutu) mantƒ±ƒüƒ±nƒ± g√ºncelle
            updateNextUpBox();

            // ƒ∞statistikleri g√ºncelle
            updateStats();

            // Hepsi bittiyse
            if (completed.length === totalBoxes) {
                localStorage.setItem('berat_step', 'tesbihat');
                setTimeout(() => {
                    fireConfetti();
                    showTesbihatStep();
                }, 800);
            }
        }

        function updateNextUpBox() {
            // √ñnce t√ºm next-up classlarƒ±nƒ± temizle
            document.querySelectorAll('.box.next-up').forEach(el => el.classList.remove('next-up'));

            // ƒ∞lk bo≈ü kutuyu bul
            let nextIndex = -1;
            // Sƒ±rayla gitmek i√ßin k√º√ß√ºkten b√ºy√ºƒüe sƒ±ralƒ± varsayƒ±yoruz ama completed array karƒ±≈üƒ±k olabilir
            // O y√ºzden 0'dan 100'e d√∂ng√º
            for (let i = 0; i < totalBoxes; i++) {
                if (!completed.includes(i)) {
                    nextIndex = i;
                    break;
                }
            }

            if (nextIndex !== -1) {
                const nextBox = document.getElementById(`box-${nextIndex}`);
                if (nextBox) nextBox.classList.add('next-up');
            }
        }

        // --- TAMAMLAMA EFEKTLERƒ∞ ---
        function triggerCompletionEffects(index) {
            const boxes = document.querySelectorAll('.box');
            const box = boxes[index];
            if (!box) return;

            const rect = box.getBoundingClientRect();
            const centerX = rect.left + window.scrollX + rect.width / 2;
            const centerY = rect.top + window.scrollY + rect.height / 2;

            // Kutucuƒüa animasyon class'ƒ± ekle
            setTimeout(() => {
                const updatedBoxes = document.querySelectorAll('.box');
                const updatedBox = updatedBoxes[index];
                if (updatedBox) {
                    updatedBox.classList.add('just-completed');
                    setTimeout(() => updatedBox.classList.remove('just-completed'), 600);
                }
            }, 50);

            // I≈üƒ±k halkasƒ± efekti
            createRipple(centerX, centerY);

            // Yƒ±ldƒ±z par√ßacƒ±klarƒ±
            createStarParticles(centerX, centerY);

            // Milestone kontrol√º (her 10 selamda bir)
            const count = completed.length;
            if (count === 10 || count === 25 || count === 40 || count === 50) {
                showMilestoneToast(count);
                // Milestone'larda mini konfeti
                setTimeout(() => {
                    confetti({
                        particleCount: 50,
                        spread: 60,
                        origin: {
                            x: (centerX - window.scrollX) / window.innerWidth,
                            y: (centerY - window.scrollY) / window.innerHeight
                        }
                    });
                }, 200);
            }
        }

        // --- I≈ûIK HALKASI ---
        function createRipple(x, y) {
            const ripple = document.createElement('div');
            ripple.className = 'ripple-effect';
            ripple.style.left = (x - 10) + 'px';
            ripple.style.top = (y - 10) + 'px';
            document.body.appendChild(ripple);
            setTimeout(() => ripple.remove(), 800);
        }

        // --- YILDIZ PAR√áACIKLARI ---
        function createStarParticles(x, y) {
            const symbols = ['‚ú¶', '‚úß', '‚òÖ', '‚òÜ', '‚ú®'];
            for (let i = 0; i < 6; i++) {
                const particle = document.createElement('div');
                particle.className = 'star-particle';
                particle.innerText = symbols[Math.floor(Math.random() * symbols.length)];
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';

                // Rastgele y√∂n
                const angle = (i / 6) * Math.PI * 2;
                const distance = 40 + Math.random() * 30;
                particle.style.setProperty('--tx', Math.cos(angle) * distance + 'px');
                particle.style.setProperty('--ty', Math.sin(angle) * distance + 'px');

                document.body.appendChild(particle);
                setTimeout(() => particle.remove(), 800);
            }
        }

        // --- Mƒ∞LESTONE TOAST ---
        function showMilestoneToast(count) {
            const messages = {
                10: 'üåô 10 Selam Tamamlandƒ±!',
                25: '‚≠ê Yarƒ±sƒ±na Ula≈ütƒ±n!',
                40: 'üî• 40 Selam Tamamlandƒ±! Az Kaldƒ±!',
                50: 'üéâ M√¢≈ü√¢allah! Tamamlandƒ±!'
            };

            const overlay = document.createElement('div');
            overlay.className = 'milestone-overlay';

            const toast = document.createElement('div');
            toast.className = 'milestone-toast';
            toast.innerText = messages[count] || `${count} Selam!`;

            overlay.appendChild(toast);
            document.body.appendChild(overlay);

            setTimeout(() => overlay.remove(), 2500);
        }

        function updateStats() {
            const count = completed.length;
            const percentage = (count / totalBoxes) * 100;

            progressFill.style.width = `${percentage}%`;
            rakatCountEl.innerText = `${count * 2} / 100`;
            completedCountEl.innerText = `${count} / 50 Selam`;

            // Renk deƒüi≈üimi: Sona yakla≈ütƒ±k√ßa ye≈üile d√∂ner
            if (percentage === 100) {
                progressFill.style.background = 'var(--success)';
            }
        }

        // --- ACCORDION ---
        function toggleInfo() {
            const content = document.getElementById('infoContent');
            const icon = document.getElementById('infoIcon');
            content.classList.toggle('open');
            icon.classList.toggle('fa-chevron-up');
            icon.classList.toggle('fa-chevron-down');
        }

        function toggleFazilet() {
            const content = document.getElementById('faziletContent');
            const icon = document.getElementById('faziletIcon');
            content.classList.toggle('open');
            icon.classList.toggle('fa-chevron-up');
            icon.classList.toggle('fa-chevron-down');
        }

        // --- TASKS ---
        function renderTasks() {
            const list = document.getElementById('taskList');
            tesbihatData.forEach((item, idx) => {
                const div = document.createElement('div');
                div.className = 'task-item';
                div.dataset.index = idx;

                const hasDetails = item.arabic && item.turkish;

                div.innerHTML = `
                    <div class="task-header">
                        <div class="custom-checkbox"><i class="fas fa-check" style="font-size:12px; display:none;"></i></div>
                        <span class="task-text">${item.text}</span>
                        <span class="task-count">${item.count} kere</span>
                    </div>
                    ${hasDetails ? `
                    <div class="task-details">
                        <div class="task-arabic">${item.arabic}</div>
                        <div class="task-turkish">${item.turkish}</div>
                        <button class="task-check-btn" onclick="completeTask(${idx})">
                            <i class="fas fa-check" style="margin-right:6px;"></i> Tamamladƒ±m
                        </button>
                    </div>
                    ` : `
                    <div class="task-details">
                        <div class="task-turkish" style="text-align:center; border-left:none;">
                            Y√¢s√Æn-i ≈ûer√Æf'i okuyunuz
                        </div>
                        <button class="task-check-btn" onclick="completeTask(${idx})">
                            <i class="fas fa-check" style="margin-right:6px;"></i> Tamamladƒ±m
                        </button>
                    </div>
                    `}
                `;

                // Checkbox'a tƒ±klanmasƒ± task'ƒ± tamamlasƒ±n
                div.querySelector('.custom-checkbox').onclick = function (e) {
                    e.stopPropagation();
                    if (!div.classList.contains('checked')) {
                        completeTask(idx);
                    }
                };

                // Header'ƒ±n tƒ±klanmasƒ± kartƒ± a√ßsƒ±n (check edilmemi≈üse)
                div.querySelector('.task-header').onclick = function (e) {
                    // Checkbox'a tƒ±klanmadƒ±ysa
                    if (!e.target.closest('.custom-checkbox') && !div.classList.contains('checked')) {
                        openTask(idx);
                    }
                };

                list.appendChild(div);
            });

            // ƒ∞lk tamamlanmamƒ±≈üƒ± a√ß
            openFirstUncheckedTask();
        }

        function openTask(index) {
            const allItems = document.querySelectorAll('.task-item');
            allItems.forEach((item, idx) => {
                if (idx === index && !item.classList.contains('checked')) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });

            // A√ßƒ±lan kartƒ± g√∂r√ºn√ºr alana kaydƒ±r
            setTimeout(() => {
                const activeItem = document.querySelector('.task-item.active');
                if (activeItem) {
                    activeItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }, 100);
        }

        function openFirstUncheckedTask() {
            const allItems = document.querySelectorAll('.task-item');
            for (let i = 0; i < allItems.length; i++) {
                if (!allItems[i].classList.contains('checked')) {
                    openTask(i);
                    return;
                }
            }
        }

        function completeTask(index) {
            const allItems = document.querySelectorAll('.task-item');
            const item = allItems[index];

            // Check i≈üareti
            item.classList.add('checked');
            item.classList.remove('active');
            const icon = item.querySelector('.fa-check');
            if (icon) icon.style.display = 'block';

            // State'i kaydet
            if (!completedTasks.includes(index)) {
                completedTasks.push(index);
            }
            localStorage.setItem('berat_tasks', JSON.stringify(completedTasks));

            // Sonraki tamamlanmamƒ±≈üƒ± a√ß
            let nextIndex = -1;
            for (let i = 0; i < allItems.length; i++) {
                if (!allItems[i].classList.contains('checked')) {
                    nextIndex = i;
                    break;
                }
            }

            if (nextIndex >= 0) {
                setTimeout(() => openTask(nextIndex), 300);
            }

            // T√ºm g√∂revler bitti mi?
            const checkedItems = document.querySelectorAll('.task-item.checked');
            document.getElementById('btnNext').disabled = (allItems.length !== checkedItems.length);
        }

        function toggleTask(el) {
            // Eski fonksiyon - geriye uyumluluk i√ßin
            el.classList.toggle('checked');
            const icon = el.querySelector('.fa-check');
            icon.style.display = el.classList.contains('checked') ? 'block' : 'none';

            // Tesbihat durumunu kaydet
            const allItems = document.querySelectorAll('.task-item');
            completedTasks = [];
            allItems.forEach((item, idx) => {
                if (item.classList.contains('checked')) {
                    completedTasks.push(idx);
                }
            });
            localStorage.setItem('berat_tasks', JSON.stringify(completedTasks));

            // T√ºm g√∂revler bitti mi?
            const checkedItems = document.querySelectorAll('.task-item.checked');
            document.getElementById('btnNext').disabled = (allItems.length !== checkedItems.length);
        }

        // --- FORM AKI≈ûI ---
        function openEarlyForm() {
            localStorage.setItem('berat_is_early', 'true');
            isEarlySubmission = true;
            modal.classList.add('active');
            document.getElementById('stepTesbihat').classList.add('hidden');
            document.getElementById('stepForm').classList.remove('hidden');
            document.getElementById('stepSuccess').classList.add('hidden');
            localStorage.setItem('berat_step', 'form');
            initFormValidation();
        }

        let addressAutocomplete = null;
        let formValidation = {
            name: false,
            phone: false,
            email: false,
            address: false
        };

        // --- FORM AKI≈ûI ---
        function showTesbihatStep() {
            modal.classList.add('active');
            document.getElementById('stepTesbihat').classList.remove('hidden');
            document.getElementById('stepForm').classList.add('hidden');
            document.getElementById('stepSuccess').classList.add('hidden');
            localStorage.setItem('berat_step', 'tesbihat');
            // Tesbihat durumunu (checkboxlarƒ±) g√∂rsel olarak g√ºncelle
            restoreTaskState();
        }

        function showForm() {
            // Eƒüer form daha √∂nce g√∂nderildiyse direkt ba≈üarƒ± ekranƒ±na git
            if (localStorage.getItem('berat_form_submitted') === 'true') {
                localStorage.setItem('berat_step', 'success');
                document.getElementById('stepTesbihat').classList.add('hidden');
                document.getElementById('stepForm').classList.add('hidden');
                document.getElementById('stepSuccess').classList.remove('hidden');
                return;
            }

            document.getElementById('stepTesbihat').classList.add('hidden');
            document.getElementById('stepForm').classList.remove('hidden');
            localStorage.setItem('berat_step', 'form');
            // ƒ∞kinci kez konfeti
            fireConfetti();

            // Form validasyonlarƒ±nƒ± ba≈ülat
            initFormValidation();
        }

        function initFormValidation() {
            // Telefon validasyonu - intl-tel-input tarafƒ±ndan y√∂netiliyor
            // Eski + ekleme kodu kaldƒ±rƒ±ldƒ±

            // Email validasyonu
            const emailInputEl = document.getElementById('inputEmail');
            if (emailInputEl) {
                emailInputEl.addEventListener('blur', validateEmail);
                emailInputEl.addEventListener('input', validateEmail);
            }

            // ƒ∞sim validasyonu
            const nameInputEl = document.getElementById('inputName');
            if (nameInputEl) {
                nameInputEl.addEventListener('input', validateName);
            }

            // Adres Google Places ba≈ülat (eƒüer API y√ºkl√ºyse)
            initAddressAutocomplete();
        }

        function initGooglePlaces() {
            // Google Places API callback
            initAddressAutocomplete();
        }

        // Google API'yi window'a baƒüla
        window.initGooglePlaces = initGooglePlaces;

        // Google Places API'yi dinamik olarak y√ºkle
        const GOOGLE_API_KEY = ''; // API key'inizi buraya yazƒ±n

        function loadGooglePlacesAPI() {
            if (!GOOGLE_API_KEY || GOOGLE_API_KEY === '' || GOOGLE_API_KEY === 'YOUR_GOOGLE_API_KEY') {
                console.log('Google Places API key tanƒ±mlanmamƒ±≈ü. Manuel adres giri≈üi aktif.');
                return;
            }

            const script = document.createElement('script');
            script.src = `https://maps.googleapis.com/maps/api/js?key=${GOOGLE_API_KEY}&libraries=places&callback=initGooglePlaces`;
            script.async = true;
            script.defer = true;
            script.onerror = function () {
                console.log('Google Places API y√ºklenemedi. Manuel adres giri≈üi aktif.');
            };
            document.head.appendChild(script);
        }

        function initAddressAutocomplete() {
            const addressInputEl = document.getElementById('inputAddress');
            if (!addressInputEl) return;

            // Google API y√ºklenmediyse, manuel adres giri≈üine izin ver
            if (!window.google || !window.google.maps || !window.google.maps.places) {
                console.log('Google Places API mevcut deƒüil. Manuel adres giri≈üi aktif.');
                addressInputEl.placeholder = 'Adresinizi yazƒ±n...';
                addressInputEl.addEventListener('input', function () {
                    formValidation.address = this.value.length > 10;
                    updateAddressUI();
                    checkFormValidity();
                });
                return;
            }

            addressAutocomplete = new google.maps.places.Autocomplete(addressInputEl, {
                types: ['address'],
                componentRestrictions: { country: ['tr', 'de', 'nl', 'be', 'fr', 'at', 'ch'] }
            });

            addressAutocomplete.addListener('place_changed', function () {
                const place = addressAutocomplete.getPlace();

                if (place.formatted_address) {
                    document.getElementById('addressFull').value = place.formatted_address;

                    // ≈ûehir ve √ºlke bilgisini √ßƒ±kar
                    let city = '', country = '';
                    if (place.address_components) {
                        place.address_components.forEach(comp => {
                            if (comp.types.includes('locality')) city = comp.long_name;
                            if (comp.types.includes('administrative_area_level_1') && !city) city = comp.long_name;
                            if (comp.types.includes('country')) country = comp.long_name;
                        });
                    }
                    document.getElementById('addressCity').value = city;
                    document.getElementById('addressCountry').value = country;

                    formValidation.address = true;
                    updateAddressUI();
                    checkFormValidity();
                }
            });

            addressInputEl.addEventListener('input', function () {
                formValidation.address = false;
                updateAddressUI();
                checkFormValidity();
            });
        }

        function validatePhone() {
            const phoneInputEl = document.getElementById('inputPhone');
            const phone = phoneInputEl.value.trim();

            // intl-tel-input ile √ºlke kodu ayrƒ± g√∂steriliyor
            // Input'ta sadece ulusal numara var (+ yok)
            const digitsOnly = phone.replace(/\D/g, '');

            if (phone === '') {
                formValidation.phone = false;
                phoneInputEl.classList.remove('valid', 'invalid');
            } else if (digitsOnly.length >= 7 && digitsOnly.length <= 15) {
                // En az 7 rakam (ulusal numara)
                formValidation.phone = true;
                phoneInputEl.classList.remove('invalid');
                phoneInputEl.classList.add('valid');
            } else {
                formValidation.phone = false;
                phoneInputEl.classList.remove('valid');
                phoneInputEl.classList.add('invalid');
            }
            checkFormValidity();
        }

        function validateEmail() {
            const emailInputEl = document.getElementById('inputEmail');
            const errorEl = document.getElementById('emailError');
            const email = emailInputEl.value.trim();

            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

            if (email === '') {
                formValidation.email = false;
                emailInputEl.classList.remove('valid', 'invalid');
                errorEl.textContent = '';
            } else if (emailRegex.test(email)) {
                formValidation.email = true;
                emailInputEl.classList.remove('invalid');
                emailInputEl.classList.add('valid');
                errorEl.textContent = '‚úì Ge√ßerli e-posta';
                errorEl.className = 'validation-message success';
            } else {
                formValidation.email = false;
                emailInputEl.classList.remove('valid');
                emailInputEl.classList.add('invalid');
                errorEl.textContent = 'Ge√ßerli bir e-posta adresi girin';
                errorEl.className = 'validation-message error';
            }
            checkFormValidity();
        }

        function validateName() {
            const nameInputEl = document.getElementById('inputName');
            const errorEl = document.getElementById('nameError');
            const name = nameInputEl.value.trim();

            if (name === '') {
                formValidation.name = false;
                nameInputEl.classList.remove('valid', 'invalid');
                errorEl.textContent = '';
                errorEl.className = 'validation-message';
            } else if (name.length < 3) {
                formValidation.name = false;
                nameInputEl.classList.remove('valid');
                nameInputEl.classList.add('invalid');
                errorEl.textContent = 'En az 3 karakter girin';
                errorEl.className = 'validation-message error';
            } else if (!name.includes(' ')) {
                formValidation.name = false;
                nameInputEl.classList.remove('valid');
                nameInputEl.classList.add('invalid');
                errorEl.textContent = 'L√ºtfen soyadƒ±nƒ±zƒ± da giriniz';
                errorEl.className = 'validation-message error';
            } else {
                formValidation.name = true;
                nameInputEl.classList.remove('invalid');
                nameInputEl.classList.add('valid');
                errorEl.textContent = '';
                errorEl.className = 'validation-message';
            }
            checkFormValidity();
        }

        function updateAddressUI() {
            const addressInputEl = document.getElementById('inputAddress');
            const errorEl = document.getElementById('addressError');
            const hasGoogleAPI = window.google && window.google.maps && window.google.maps.places;

            if (formValidation.address) {
                addressInputEl.classList.remove('invalid');
                addressInputEl.classList.add('valid');
                errorEl.textContent = '‚úì Adres kabul edildi';
                errorEl.className = 'validation-message success';
            } else if (addressInputEl.value.length > 0) {
                addressInputEl.classList.remove('valid');
                // Google API yokken hata g√∂sterme, sadece uzunluk kontrol√º yap
                if (!hasGoogleAPI && addressInputEl.value.length <= 10) {
                    addressInputEl.classList.add('invalid');
                    errorEl.textContent = 'En az 10 karakter girin';
                    errorEl.className = 'validation-message error';
                } else if (hasGoogleAPI) {
                    addressInputEl.classList.add('invalid');
                    errorEl.textContent = 'Listeden bir adres se√ßin';
                    errorEl.className = 'validation-message error';
                } else {
                    addressInputEl.classList.remove('invalid');
                    errorEl.textContent = '';
                }
            } else {
                addressInputEl.classList.remove('valid', 'invalid');
                errorEl.textContent = '';
            }
        }

        function checkFormValidity() {
            const allValid = formValidation.name && formValidation.phone && formValidation.email && formValidation.address;
            document.getElementById('submitBtn').disabled = !allValid;
        }

        // Google Sheets'e veri g√∂nderme
        const GOOGLE_SHEET_URL = 'https://script.google.com/macros/s/AKfycbyItLmXXCcxNt4a96dCEIZbY78AMk3Ado-DzUuPo0SulO0GllGkaET7uj-WKnDy6TkXnQ/exec';

        // Ziyaret takibi - lightweight beacon
        function trackVisit() {
            const referral = getReferralCode();
            const device = getDeviceType();
            const timestamp = new Date().toISOString();

            const params = new URLSearchParams({
                gid: 1366164289,  // Visits sheet
                referral: referral,
                device: device,
                timestamp: timestamp
            });

            const url = `${GOOGLE_SHEET_URL}?${params.toString()}`;

            // navigator.sendBeacon daha hafif, fetch'e fallback
            if (navigator.sendBeacon) {
                navigator.sendBeacon(url);
            } else {
                fetch(url, { mode: 'no-cors' }).catch(() => { });
            }

            console.log('Ziyaret kaydedildi:', { referral, device });
        }

        async function submitForm(e) {
            e.preventDefault();

            const submitBtn = document.getElementById('submitBtn');
            const formError = document.getElementById('formError');

            // Butonu devre dƒ±≈üƒ± bƒ±rak
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> G√∂nderiliyor...';
            formError.textContent = '';

            // Tam uluslararasƒ± numarayƒ± al
            let fullPhoneNumber = '';
            if (typeof phoneInput !== 'undefined' && phoneInput) {
                // Se√ßili √ºlkenin dial kodunu al
                const countryData = phoneInput.getSelectedCountryData();
                const dialCode = countryData.dialCode || '';
                const nationalNumber = document.getElementById('inputPhone').value.trim().replace(/\D/g, '');

                if (dialCode && nationalNumber) {
                    fullPhoneNumber = '+' + dialCode + nationalNumber;
                } else {
                    fullPhoneNumber = phoneInput.getNumber();
                }
            }
            // Fallback: hidden field veya input deƒüeri
            if (!fullPhoneNumber) {
                fullPhoneNumber = document.getElementById('phoneIntl').value || document.getElementById('inputPhone').value.trim();
            }

            console.log("Telefon numarasƒ±:", fullPhoneNumber);

            // Veri toplama
            const data = {
                name: document.getElementById('inputName').value.trim(),
                phone: fullPhoneNumber,
                email: document.getElementById('inputEmail').value.trim(),
                address: document.getElementById('addressFull').value || document.getElementById('inputAddress').value,
                city: document.getElementById('addressCity').value,
                country: document.getElementById('addressCountry').value,
                referral: getReferralCode(),
                device: getDeviceType(),
                timestamp: new Date().toISOString(),
                completedRakats: isEarlySubmission ? 0 : (completed.length * 2)
            };

            console.log("G√∂nderilen Veri:", data);

            try {
                // URL parametrelerini olu≈ütur
                const params = new URLSearchParams({
                    gid: 0,
                    name: data.name,
                    phone: data.phone,
                    email: data.email,
                    address: data.address,
                    city: data.city || '',
                    country: data.country || '',
                    referral: data.referral,
                    device: data.device,
                    timestamp: data.timestamp,
                    completedRakats: data.completedRakats
                });

                const fullUrl = `${GOOGLE_SHEET_URL}?${params.toString()}`;

                // Google Sheets'e g√∂nder (GET request)
                await fetch(fullUrl, {
                    method: 'GET',
                    mode: 'no-cors'
                });

                // Durumu g√ºncelle
                localStorage.setItem('berat_step', 'success');
                localStorage.setItem('berat_form_submitted', 'true');

                // Ba≈üarƒ±lƒ± UI
                document.getElementById('stepForm').classList.add('hidden');
                document.getElementById('stepSuccess').classList.remove('hidden');
                fireConfetti();

            } catch (error) {
                console.error('G√∂nderim hatasƒ±:', error);
                formError.textContent = 'Bir hata olu≈ütu, l√ºtfen tekrar deneyin.';
                formError.className = 'validation-message error';
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'Kaydƒ± Tamamla <i class="fas fa-check"></i>';
            }
        }

        // --- EFEKT ---
        function fireConfetti() {
            var count = 200;
            var defaults = {
                origin: { y: 0.7 }
            };

            function fire(particleRatio, opts) {
                confetti(Object.assign({}, defaults, opts, {
                    particleCount: Math.floor(count * particleRatio)
                }));
            }

            fire(0.25, { spread: 26, startVelocity: 55, });
            fire(0.2, { spread: 60, });
            fire(0.35, { spread: 100, decay: 0.91, scalar: 0.8 });
            fire(0.1, { spread: 120, startVelocity: 25, decay: 0.92, scalar: 1.2 });
            fire(0.1, { spread: 120, startVelocity: 45, });
        }

        // Ba≈ülat
        init();
    </script>

    <!-- intl-tel-input JS -->
    <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@25.2.0/build/js/intlTelInput.min.js"></script>
    <script>
        // intl-tel-input ba≈ülatma
        let phoneInput;

        document.addEventListener('DOMContentLoaded', function () {
            const input = document.getElementById('inputPhone');

            phoneInput = window.intlTelInput(input, {
                // Sadece hedef √ºlkeler (T√ºrk diasporasƒ± + yaygƒ±n √ºlkeler)
                onlyCountries: [
                    "tr", // T√ºrkiye
                    "de", // Almanya
                    "nl", // Hollanda
                    "be", // Bel√ßika
                    "fr", // Fransa
                    "at", // Avusturya
                    "ch", // ƒ∞svi√ßre
                    "se", // ƒ∞sve√ß
                    "no", // Norve√ß
                    "dk", // Danimarka
                    "gb", // ƒ∞ngiltere
                    "us", // ABD
                    "ca", // Kanada
                    "au", // Avustralya
                    "sa", // Suudi Arabistan
                    "ae", // BAE
                    "qa", // Katar
                    "kw", // Kuveyt
                    "az", // Azerbaycan
                    "kz", // Kazakistan
                    "it", // ƒ∞talya
                    "es", // ƒ∞spanya
                    "gr", // Yunanistan
                    "bg", // Bulgaristan
                    "ro", // Romanya
                    "pl", // Polonya
                    "ru", // Rusya
                    "ua", // Ukrayna
                    "ba", // Bosna
                    "xk", // Kosova
                    "mk", // Kuzey Makedonya
                    "al", // Arnavutluk
                ],
                // IP tabanlƒ± otomatik √ºlke tespiti
                initialCountry: "auto",
                geoIpLookup: function (callback) {
                    fetch("https://ipapi.co/json")
                        .then(res => res.json())
                        .then(data => callback(data.country_code))
                        .catch(() => callback("tr")); // Hata durumunda T√ºrkiye
                },
                // Temel ayarlar
                separateDialCode: true,  // √úlke kodu solda ayrƒ± g√∂sterilsin
                nationalMode: true,       // Input'ta sadece ulusal numara, + eklemesin
                allowDropdown: true,      // √úlke se√ßimi a√ßƒ±lsƒ±n
                countrySearch: true,
                autoPlaceholder: "polite",
                i18n: {
                    searchPlaceholder: "√úlke ara...",
                    noResultsMessage: "Sonu√ß bulunamadƒ±",
                    selectedCountryAriaLabel: "Se√ßili √ºlke",
                    countryListAriaLabel: "√úlke listesi"
                }
            });

            // √úlke kodu tespiti SADECE paste i≈üleminde √ßalƒ±≈üsƒ±n
            // Normal yazmada m√ºdahale etmesin
            input.addEventListener('paste', function () {
                setTimeout(handlePhoneInput, 50);
            });

            // Numara g√ºncellemesi ve validasyon
            input.addEventListener('input', function () {
                updatePhoneIntl();
                validatePhone();
            });
            input.addEventListener('change', function () {
                updatePhoneIntl();
                validatePhone();
            });
            input.addEventListener('blur', function () {
                updatePhoneIntl();
                validatePhone();
            });
        });

        // √úlke kodlarƒ± listesi (onlyCountries ile e≈üle≈ümeli)
        const countryCodes = {
            '90': 'tr',   // T√ºrkiye
            '49': 'de',   // Almanya
            '31': 'nl',   // Hollanda
            '32': 'be',   // Bel√ßika
            '33': 'fr',   // Fransa
            '43': 'at',   // Avusturya
            '41': 'ch',   // ƒ∞svi√ßre
            '46': 'se',   // ƒ∞sve√ß
            '47': 'no',   // Norve√ß
            '45': 'dk',   // Danimarka
            '44': 'gb',   // ƒ∞ngiltere
            '1': 'us',    // ABD/Kanada
            '61': 'au',   // Avustralya
            '966': 'sa',  // Suudi Arabistan
            '971': 'ae',  // BAE
            '974': 'qa',  // Katar
            '965': 'kw',  // Kuveyt
            '994': 'az',  // Azerbaycan
            '7': 'kz',    // Kazakistan (ve Rusya)
            '39': 'it',   // ƒ∞talya
            '34': 'es',   // ƒ∞spanya
            '30': 'gr',   // Yunanistan
            '359': 'bg',  // Bulgaristan
            '40': 'ro',   // Romanya
            '48': 'pl',   // Polonya
            '380': 'ua',  // Ukrayna
            '387': 'ba',  // Bosna
            '383': 'xk',  // Kosova
            '389': 'mk',  // Kuzey Makedonya
            '355': 'al',  // Arnavutluk
        };

        function handlePhoneInput() {
            if (!phoneInput) return;

            const input = document.getElementById('inputPhone');
            let value = input.value.trim();

            // Eƒüer + ile ba≈ülƒ±yorsa, √ºlke kodu tespit et
            if (value.startsWith('+') || value.startsWith('00')) {
                // + veya 00 prefix'ini temizle
                let cleanValue = value.replace(/^(\+|00)/, '');

                // √úlke kodunu bul (3 haneli, 2 haneli, 1 haneli sƒ±rayla dene)
                let matchedCode = null;
                let matchedCountry = null;

                for (let len = 3; len >= 1; len--) {
                    const possibleCode = cleanValue.substring(0, len);
                    if (countryCodes[possibleCode]) {
                        matchedCode = possibleCode;
                        matchedCountry = countryCodes[possibleCode];
                        break;
                    }
                }

                if (matchedCode && matchedCountry) {
                    // √úlkeyi deƒüi≈ütir
                    phoneInput.setCountry(matchedCountry);

                    // √úlke kodunu input'tan kaldƒ±r, sadece numarayƒ± bƒ±rak
                    const nationalNumber = cleanValue.substring(matchedCode.length);
                    input.value = nationalNumber;
                }
            }

            // Her durumda full numarayƒ± g√ºncelle
            updatePhoneIntl();
        }

        function updatePhoneIntl() {
            if (phoneInput) {
                // Se√ßili √ºlkenin dial kodunu al ve manuel olarak birle≈ütir
                const countryData = phoneInput.getSelectedCountryData();
                const dialCode = countryData.dialCode || '';
                const nationalNumber = document.getElementById('inputPhone').value.trim().replace(/\D/g, '');

                let fullNumber = '';
                if (dialCode && nationalNumber) {
                    fullNumber = '+' + dialCode + nationalNumber;
                }
                document.getElementById('phoneIntl').value = fullNumber;
            }
        }
    </script>
</body>

</html>
